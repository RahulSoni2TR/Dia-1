<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Product Management</title>
  <link rel="stylesheet" href="home_style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="logo">Product<span>Manager</span></div>
    <div class="logout-container">
      <div class="dropdown">
        <button class="dropbtn">
          <i class="fas fa-user-circle"></i> User Options
        </button>
        <div class="dropdown-content">
          <a href="/permissions" th:if="${session.roles.contains('ROLE_ADMIN')}"><i class="fas fa-key"></i> User Permissions</a>
          <a href="/logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>
      </div>
    </div>
  </header>
<!-- Scrolling Prices Header -->
<div class="scrolling-prices-container">
    <div class="scrolling-prices">
        <span class="scrolling-text" id="priceLabel">Loading prices...</span>
    </div>
</div>

<!-- Price Reminder Popup -->
<div id="pricePopup" class="popup-overlay">
    <div class="popup-content">
        <span class="close-btn" onclick="closePopup()">&times;</span>
        <h2>Set Prices Reminder</h2>
        <p>Have you updated the prices today?</p>
        <button onclick="redirectToSetPrices()">Set Prices Now</button>
        <button onclick="dismissForToday()">Prices are already set</button>
    </div>
</div>


  <!-- Main Content -->
  <div class="container">
    <h1>Welcome, <span th:text="${session.username}">Guest</span>!</h1>
    <p class="subtitle">Your one-stop solution for managing all product operations</p>
    <!-- Action Buttons -->
    <div class="button-container">
    <button class="action-button" onclick="window.location.href='/add-product'"
      th:if="${session.roles.contains('ROLE_ADMIN')}">
      <i class="fas fa-plus"></i> Add Product
    </button>
    <button class="action-button" onclick="window.location.href='/remove-product'"
      th:if="${session.roles.contains('ROLE_ADMIN')}">
      <i class="fas fa-trash"></i> Remove Product
    </button>
     <button class="action-button" onclick="window.location.href='/modify-product'"
      th:if="${session.roles.contains('ROLE_EDITOR') or session.roles.contains('ROLE_ADMIN')}">
      <i class="fas fa-edit"></i> Modify Product
    </button>
    <button class="action-button" onclick="window.location.href='/view-product'"
      th:if="${session.roles.contains('ROLE_EDITOR') or session.roles.contains('ROLE_ADMIN') or session.roles.contains('ROLE_VIEWER')}">
      <i class="fas fa-eye"></i> View Products
    </button>
    <button class="action-button" onclick="window.location.href='/set-price'"
      th:if="${session.roles.contains('ROLE_EDITOR') or session.roles.contains('ROLE_ADMIN')}">
      <i class="fas fa-dollar-sign"></i> Set Prices
    </button>
    <button class="action-button" onclick="window.location.href='/generate-report'"
      th:if="${session.roles.contains('ROLE_EDITOR') or session.roles.contains('ROLE_ADMIN')}">
      <i class="fas fa-file-alt"></i> Generate Report
    </button>
      <button class="action-button" onclick="window.location.href='/import-data'"
       th:if="${session.roles.contains('ROLE_ADMIN')}">
        <i class="fas fa-file-import"></i> Import Data
      </button>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <p>&copy; 2024 Product Management System. All rights reserved.</p>
  </footer>
  <script>
  document.addEventListener("DOMContentLoaded", function () {
	    fetchPrices();  // Fetch price data
	    checkPricePopup();  // Check if popup should be shown
	});


  function fetchPrices() {
      fetch('/rates')
          .then(response => response.json())
          .then(data => {
              const prices = {
                  gold_10k: getPriceForCommodity(data, '10.00'),
                  gold_14k: getPriceForCommodity(data, '14.00'),
                  gold_18k: getPriceForCommodity(data, '18.00'),
                  gold_22k: getPriceForCommodity(data, '22.00'),
                  gold_24k: getPriceForCommodity(data, '24.00'),
                  silver: getPriceForCommodity(data, 'silver'),
                  diamond: getPriceForCommodity(data, 'diamond'),
                  gst: getPriceForCommodity(data, 'gst')
              };

              const priceLabel = `Gold 10K: ₹${prices.gold_10k} | Gold 14K: ₹${prices.gold_14k} | Gold 18K: ₹${prices.gold_18k} | Gold 22K: ₹${prices.gold_22k} | Gold 24K: ₹${prices.gold_24k} | Silver: ₹${prices.silver} | Diamond: ₹${prices.diamond} | GST: ${prices.gst}%`;

              document.getElementById("priceLabel").textContent = priceLabel;
          })
          .catch(error => {
              console.error('Error fetching prices:', error);
              document.getElementById("priceLabel").textContent = "Failed to load prices.";
          });
  }

  function getPriceForCommodity(data, commodity) {
      const rate = data.find(item => item.commodity === commodity);
      return rate ? rate.price : 'N/A';
  }
  
  function checkPricePopup() {
      const lastDismissed = localStorage.getItem("pricePopupDismissed");
      const now = new Date();
      const lastDismissedDate = lastDismissed ? new Date(lastDismissed) : null;

      if (!lastDismissedDate || now.getDate() !== lastDismissedDate.getDate()) {
          showPopup();
      } else {
          const hoursSinceDismissed = (now - lastDismissedDate) / (1000 * 60 * 60);
          if (hoursSinceDismissed >= 6) {
              showPopup();  // Show again after 6 hours if not dismissed for the whole day
          }
      }
  }

  function showPopup() {
      document.getElementById("pricePopup").style.display = "flex";
  }

  function closePopup() {
      document.getElementById("pricePopup").style.display = "none";
  }

  function redirectToSetPrices() {
      window.location.href = "/set-price";
  }

  function dismissForToday() {
      const now = new Date();
      localStorage.setItem("pricePopupDismissed", now);
      closePopup();
  }
</script>
</body>
</html>
