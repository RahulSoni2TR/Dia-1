<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="set_price_style.css">
    <title>Set Prices</title>
</head>
<body>
    <div class="container">
        <!-- Moving Prices Label -->
        <div class="moving-prices">
            <span class="scrolling-text" id="priceLabel">Loading prices...</span>
        </div>

        <h2>Set Prices</h2>
        
        <!-- Gold Price Field -->
        <div class="form-group">
            <label for="goldPrice">Gold Price</label>
            <input type="text" id="goldPrice" placeholder="Enter Gold Price">
        </div>

        <!-- Diamond Price Field -->
        <div class="form-group">
            <label for="diamondPrice">Diamond Price</label>
            <input type="text" id="diamondPrice" placeholder="Enter Diamond Price">
        </div>

        <!-- Vilandi Price Field -->
        <div class="form-group">
            <label for="labourPrice">Labour Price</label>
            <input type="text" id="labourPrice" placeholder="Enter Labour Price">
        </div>
        
        <div class="form-group">
            <label for="gstPrice">GST Price</label>
            <input type="text" id="gstPrice" placeholder="Enter GST Price">
        </div>

        <!-- Button Group for Set and Edit Prices -->
        <div class="button-group">
            <!-- Set Prices Button -->
            <button onclick="setPrices()">Set Prices</button>
            <button onclick="fetchPrices()">Refresh Prices</button>
            
        <!-- Back to Home Button on a new row -->
        <div class="button-group">
            <button onclick="window.location.href='/home'">Back to Home</button>
        </div>
    </div>

   <script>
    // Function to fetch prices from the API
    function fetchPrices() {
        fetch('/rates')
            .then(response => response.json())
            .then(data => {
                // Assuming 'data' is an array of rate objects with commodity and price
                const prices = {
                    gold: getPriceForCommodity(data, 'gold'),
                    diamond: getPriceForCommodity(data, 'diamond'),
                    labour: getPriceForCommodity(data, 'labour'),
                    gst: getPriceForCommodity(data, 'gst')
                };

                // Update the moving price label with fetched values
                const priceLabel = `Gold Price: ₹${prices.gold} | Diamond Price: ₹${prices.diamond} | Labour Price: ₹${prices.labour} | GST Price: ${prices.gst}%`;
                document.getElementById("priceLabel").textContent = priceLabel;
            })
            .catch(error => {
                console.error('Error fetching prices:', error);
            });
    }

    // Helper function to get the price for a specific commodity
    function getPriceForCommodity(data, commodity) {
        const rate = data.find(item => item.commodity === commodity);
        return rate ? rate.price : 'Not Available';
    }

    // Function to set prices by posting the data
    function setPrices() {
        // Gather price data from inputs
        const prices = {
            gold: document.getElementById("goldPrice").value,
            diamond: document.getElementById("diamondPrice").value,
            silver: document.getElementById("labourPrice").value,
            gst: document.getElementById("gstPrice").value
        };

        // Send POST request to backend to update prices
        fetch('/updatePrices', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(prices)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to update prices');
            }
            return response.json();
        })
        .then(data => {
            console.log('Prices updated successfully:', data);
            fetchPrices(); 
        })
        .catch(error => {
            console.error('Error updating prices:', error);
        });
    }

    // Fetch the prices when the page loads
    window.onload = fetchPrices;
</script>
</body>
</html>
