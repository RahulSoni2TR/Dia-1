<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remove Product</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="remove_product_style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">Product<span>Manager</span></div>
        <div class="logout-container">
            <a href="/logout" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <h1>Remove Product</h1>
        <form id="productForm" onsubmit="removeProduct(event)">
            <label for="productId">Enter Design No. to Remove:</label>
            <input type="text" id="productId" name="productId" required>

            <button type="button" class="action-button" onclick="loadProductDetails()">
                <i class="fas fa-search"></i> Load Product Details
            </button>
            <div id="productDetails" class="product-details"></div>

            <button type="submit" class="action-button">
                <i class="fas fa-trash"></i> Remove Product
            </button>
        </form>
        <a href="/home" class="back-button">
            <i class="fas fa-arrow-left"></i> Back to Home
        </a>
    </div>

     <div id="notificationModal" class="modal">
        <div id="modalContent" class="modal-content">
            <h2 id="modalTitle"></h2>
            <p id="modalMessage"></p>
            <button class="close-btn">OK</button>
        </div>
    </div>

    <script>
	
	function loadProductDetails() {
            const productId = document.getElementById('productId').value;

            $.ajax({
                url: `/loadProduct/${productId}`,
                type: 'GET',
                success: function(product) {
                    const productDetailsDiv = document.getElementById('productDetails');
                    productDetailsDiv.innerHTML = `
                        <p>Product Name: ${product.item}</p>
                        <p>Price: â‚¹${product.price ? product.price.toFixed(2): ''}</p>
                        <p>Stock Quantity: ${product.stockQuantity}</p>
                        <p>Category ID: ${product.categoryId}</p>
                        ${product.imageUrl ? `<img src="${product.imageUrl}" alt="Product Image" />` : ''}
                    `;
                },
                error: function() {
                    const productDetailsDiv = document.getElementById('productDetails');
                    productDetailsDiv.innerHTML = `<p style="color: red;">Product not found.</p>`;
                }
            });
        }

    function showModal(title, message, isSuccess) {
        const modal = $("#notificationModal");
        const modalContent = $("#modalContent");

        // Update modal content and styling
        $("#modalTitle").text(title);
        $("#modalMessage").text(message);
        modalContent.removeClass("modal-success modal-error");
        modalContent.addClass(isSuccess ? "modal-success" : "modal-error");

        // Show the modal
        modal.fadeIn();
    }
        // Close modal on button click
            $(".close-btn").on("click", function () {
                $("#notificationModal").fadeOut();
            });
            
        
        function removeProduct(event) {
            event.preventDefault(); // Prevent default form submission

            const productId = document.getElementById('productId').value;
            const xhr = new XMLHttpRequest();
            xhr.open('POST', `/remove/${productId}`, true);

            xhr.onload = function () {
                if (xhr.status === 200) {
                    showModal("Success", "Product removed successfully!", true);

                    // Clear the form
                    $("#productForm")[0].reset();

                    // Attach redirect logic to the OK button
                    $(".close-btn").off("click").on("click", function () {
                        $("#notificationModal").fadeOut(() => {
                            window.location.href = '/remove-product'; // Redirect after closing the modal
                        });
                    });
                } else {
                    showModal("Error", "Error removing product!", false);

                    // Close modal without redirecting for error case
                    $(".close-btn").off("click").on("click", function () {
                        $("#notificationModal").fadeOut();
                    });
                }
            };

            xhr.onerror = function () {
                showModal("Error", "Network error while removing product!", false);

                // Close modal without redirecting for network error
                $(".close-btn").off("click").on("click", function () {
                    $("#notificationModal").fadeOut();
                });
            };

            xhr.send();
        }
</script>
</body>
</html>
